# Инструкция по развертыванию Системы Мониторинга на Сервер (Упрощенная)

Это руководство поможет вам шаг за шагом разместить ваш проект "Система мониторинга образовательной среды ВУЗа" на предоставленном вам сервере (VPS), **используя встроенные инструменты Windows**, без установки дополнительных программ. Мы будем использовать IP-адрес сервера для доступа к приложению.

**Данные вашего сервера:**
*   **Операционная система:** Debian 11
*   **IP-адрес:** 194.87.238.98
*   **Пользователь:** root
*   **Пароль:** jdo5ETkp0B 


## Шаг 1: Подключение к серверу через Командную строку/PowerShell (Windows)

В Windows 10/11 есть встроенный инструмент для подключения к серверам по SSH.

1.  **Откройте Командную строку или PowerShell:**
    *   Нажмите клавишу `Win` (с логотипом Windows).
    *   Начните печатать `cmd` или `powershell`.
    *   Выберите "Командная строка" или "Windows PowerShell" из результатов поиска.
2.  **Введите команду для подключения:**
    ```powershell
    ssh root@194.87.238.98
    ```
    *   Замените `194.87.238.98` на IP-адрес вашего сервера, если он отличается.
    *   Нажмите `Enter`.
3.  **Доверие ключу сервера (при первом подключении):**
    *   Вы можете увидеть сообщение вида `The authenticity of host '194.87.238.98 (194.87.238.98)' can't be established... Are you sure you want to continue connecting (yes/no/[fingerprint])?`.
    *   Это нормально. Напечатайте `yes` и нажмите `Enter`.
4.  **Ввод пароля:**
    *   Вас попросят ввести пароль: `root@194.87.238.98's password:`
    *   **Важно:** Когда вы вводите пароль, символы *не будут отображаться* на экране. Просто аккуратно введите ваш пароль и нажмите `Enter`.
    *   Если вы все ввели правильно, вы увидите приветственное сообщение сервера и командную строку, например `root@<имя-сервера>:~#`. Поздравляем, вы подключились к серверу!

## Шаг 2: Подготовка сервера

Теперь нам нужно установить на сервер программы, необходимые для работы вашего проекта. Вводите следующие команды в окно командной строки/PowerShell (где вы подключены к серверу) по одной и нажимайте `Enter` после каждой.

1.  **Обновим список программ:**
    ```bash
    apt update
    ```
    (Подождите, пока команда завершится)
2.  **Установим необходимые пакеты:** Python, pip, venv и Git.
    ```bash
    apt install python3 python3-pip python3-venv git -y
    ```
    (Ключ `-y` автоматически отвечает "да" на все вопросы установки. Подождите завершения установки.)

## Шаг 3: Клонирование проекта из Git на сервер

Вместо копирования файлов вручную, мы скачаем их прямо из вашего Git-репозитория.

1.  **Перейдем в папку `/opt`:** Это стандартное место для установки сторонних программ.
    ```bash
    cd /opt
    ```
2.  **Клонируем репозиторий:**
    ```bash
    git clone https://github.com/Stas-OP/vuz_monitoring.git
    ```
    *   Дождитесь завершения скачивания. В папке `/opt` появится папка `vuz_monitoring` (или с другим именем, если ваш репозиторий называется иначе) с кодом проекта.

## Шаг 4: Настройка проекта на сервере

Продолжаем работать в командной строке/PowerShell, подключенной к серверу.

1.  **Перейдем в папку проекта:**
    ```bash
    cd /opt/vuz_monitoring
    ```
    (Если ваша папка называется иначе, используйте ее имя).
2.  **Создадим виртуальное окружение:**
    ```bash
    python3 -m venv venv
    ```
3.  **Активируем виртуальное окружение:**
    ```bash
    source venv/bin/activate
    ```
    (В начале строки появится `(venv)`).
4.  **Установим зависимости проекта:**
    ```bash
    pip install -r requirements.txt
    ```
    (Дождитесь завершения установки).
5.  **Установим Gunicorn:**
    ```bash
    pip install gunicorn
    ```
6.  **Применим миграции базы данных:**
    ```bash
    python manage.py migrate
    ```
7.  **Создадим начальные данные:**
    ```bash
    python manage.py shell -c "exec(open('main/initial_data.py', encoding='utf-8').read())"
    ```
    (Убедитесь, что видите сообщение "Начальные данные успешно созданы!").
8.  **Соберем статические файлы:**
    ```bash
    python manage.py collectstatic --noinput
    ```

## Шаг 5: Настройка Django для работы на сервере

Укажем Django, что IP-адрес сервера разрешен.

1.  **Откроем файл настроек:** Мы будем использовать простой текстовый редактор `nano`, который обычно уже есть в системе.
    ```bash
    nano university_monitoring/settings.py
    ```
2.  **Найдем строку `ALLOWED_HOSTS`:** Используйте стрелки на клавиатуре для перемещения курсора. Найдите строку `ALLOWED_HOSTS = []`.
3.  **Изменим строку:** Замените `[]` на `['194.87.238.98']`. Строка должна выглядеть так:
    ```python
    ALLOWED_HOSTS = ['194.87.238.98']
    ```
4.  **Сохраним изменения и выйдем:**
    *   Нажмите `Ctrl + X`.
    *   Вас спросят `Save modified buffer?`. Нажмите `Y` (Yes).
    *   Вас спросят `File Name to Write: university_monitoring/settings.py`. Просто нажмите `Enter`.

## Шаг 6: Настройка Gunicorn и Systemd (для фоновой работы)

Настроим автоматический запуск приложения в фоновом режиме.

1.  **Создадим файл сервиса для systemd:**
    ```bash
    nano /etc/systemd/system/vuz_monitoring.service
    ```
2.  **Вставим в него следующий текст:** (Можно скопировать текст отсюда и вставить в окно командной строки/PowerShell правой кнопкой мыши)

    ```ini
    [Unit]
    Description=Gunicorn instance to serve vuz_monitoring
    After=network.target

    [Service]
    User=root
    Group=root
    WorkingDirectory=/opt/vuz_monitoring
    Environment="PATH=/opt/vuz_monitoring/venv/bin"
    ExecStart=/opt/vuz_monitoring/venv/bin/gunicorn --workers 3 --bind 0.0.0.0:8000 university_monitoring.wsgi:application
    Restart=always

    [Install]
    WantedBy=multi-user.target
    ```

    *Пояснения:*
    *   `WorkingDirectory`: Папка с вашим проектом (убедитесь, что `/opt/vuz_monitoring` совпадает с именем папки, созданной после `git clone`).
    *   `Environment`: Путь к вашему виртуальному окружению.
    *   `ExecStart`: Команда запуска Gunicorn (слушает порт 8000).

3.  **Сохраним и выйдем из nano:** `Ctrl + X`, затем `Y`, затем `Enter`.
4.  **Перезагрузим конфигурацию systemd:**
    ```bash
    systemctl daemon-reload
    ```
5.  **Запустим наш сервис:**
    ```bash
    systemctl start vuz_monitoring
    ```
6.  **Включим автозапуск сервиса при загрузке сервера:**
    ```bash
    systemctl enable vuz_monitoring
    ```
7.  **Проверим статус сервиса:**
    ```bash
    systemctl status vuz_monitoring
    ```
    Вы должны увидеть `Active: active (running)`. Если нет, смотрите логи (`journalctl -u vuz_monitoring`). Нажмите `q`, чтобы выйти из просмотра статуса.

## Шаг 7: Проверка работы приложения

Теперь ваше приложение должно быть доступно в интернете!

1.  Откройте веб-браузер на вашем компьютере.
2.  В адресной строке введите:
    ```
    http://194.87.238.98:8000
    ```
3.  Нажмите `Enter`. Вы должны увидеть главную страницу вашего приложения.

**Поздравляем! Ваше приложение развернуто и работает на сервере.**

## Возможные проблемы

*   **Ошибка 502 Bad Gateway или страница не открывается:**
    *   Проверьте статус сервиса (`systemctl status vuz_monitoring`) и логи (`journalctl -u vuz_monitoring`).
    *   Убедитесь, что `ALLOWED_HOSTS` настроен верно.
    *   Проверьте, не блокирует ли порт 8000 брандмауэр `ufw`:
        ```bash
        apt install ufw -y # Установить, если его нет
        ufw allow 8000/tcp
        ufw enable # Включить firewall (ответьте 'y')
        ufw status # Проверить статус
        ```
*   **Статические файлы (CSS/картинки) не загружаются:** Для текущей простой конфигурации это ожидаемо при `DEBUG = False`. Загруженные фото должны быть доступны по прямым ссылкам.

Если возникнут проблемы, внимательно читайте сообщения об ошибках в командной строке/PowerShell и логи сервиса. 